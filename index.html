<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>3日間のお世話ゲーム</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,"Yu Gothic","Meiryo",sans-serif;
  background:#f4f5f8;
  color:#222;
  text-align:center;
}
.container{
  max-width:420px;
  margin:0 auto;
  padding:24px;
}

/* ===== キャラクター領域 ===== */
#character{
  position:relative;
  width:220px;
  height:220px;
  margin:60px auto 24px;
}

/* タネ（画像がなくても必ず見える） */
#tane{
  position:absolute;
  inset:0;
  border-radius:50%;
  background:
    radial-gradient(circle at 35% 35%, #fff, #ccc 40%, #aaa 70%);
  opacity:0.6;
  transition:opacity 2s ease, transform 2s ease;
}

/* 煙 */
.smoke{
  position:absolute;
  inset:-20px;
  border-radius:50%;
  background:
    radial-gradient(circle at center,
      rgba(180,180,180,0.7),
      rgba(180,180,180,0.0) 60%);
  filter:blur(20px);
  animation:smokeMove 6s infinite ease-in-out;
}

@keyframes smokeMove{
  0%{transform:rotate(0deg) scale(1);opacity:0.4;}
  50%{transform:rotate(180deg) scale(1.1);opacity:0.7;}
  100%{transform:rotate(360deg) scale(1);opacity:0.4;}
}

/* 生後の浮遊 */
.float{
  animation:float 3s infinite ease-in-out;
}
@keyframes float{
  0%{transform:translateY(0);}
  50%{transform:translateY(-12px);}
  100%{transform:translateY(0);}
}

/* カウントダウン */
#countdown{
  width:120px;
  height:4px;
  background:#ddd;
  margin:16px auto;
  overflow:hidden;
}
#countbar{
  height:100%;
  width:100%;
  background:#999;
  transition:width 1s linear;
}

#message{
  font-size:14px;
  color:#666;
  margin-top:8px;
}

.actions{
  margin-top:24px;
}
.actions button{
  margin:6px;
  padding:10px 14px;
  font-size:14px;
}
.hidden{display:none;}

#ending{
  font-size:28px;
  margin-top:120px;
}
#logView{
  text-align:left;
  font-size:12px;
  white-space:pre-wrap;
  margin-top:24px;
}
</style>
</head>

<body>
<div class="container">

  <div id="character">
    <div id="tane"></div>
    <div class="smoke" id="smoke"></div>
  </div>

  <div id="countdown"><div id="countbar"></div></div>
  <div id="message">……</div>

  <div class="actions hidden" id="actions">
    <button onclick="care('meal','light')">軽い食事</button>
    <button onclick="care('meal','heavy')">しっかりした食事</button>
    <button onclick="care('out','go')">外に出る</button>
    <button onclick="care('out','stay')">家で過ごす</button>
    <button onclick="care('mini','A')">ミニゲームA</button>
    <button onclick="care('mini','B')">ミニゲームB</button>
    <button onclick="clean()">排泄を片付ける</button>
  </div>

  <div id="ending" class="hidden">ありがとう</div>
  <div id="logView" class="hidden"></div>

</div>

<script>
const WAIT_TIME = 60 * 1000;
const LIFE_SPAN = 3 * 24 * 60 * 60 * 1000;
const KEY = "care_game_tane";

let data = JSON.parse(localStorage.getItem(KEY)) || {
  start: Date.now(),
  born:false,
  dead:false,
  mood:0,
  logs:{}
};

const tane = document.getElementById("tane");
const smoke = document.getElementById("smoke");
const actions = document.getElementById("actions");
const bar = document.getElementById("countbar");

function log(type,value){
  const day = Math.floor((Date.now()-data.start)/(24*60*60*1000))+1;
  if(!data.logs[day]) data.logs[day]=[];
  data.logs[day].push({time:new Date().toLocaleString(),type,value});
}

function hatch(){
  data.born=true;
  smoke.style.display="none";
  document.getElementById("countdown").style.display="none";
  tane.classList.add("float");
  tane.style.opacity="1";
  actions.classList.remove("hidden");
  log("birth","tane_visible");
  save();
}

function tick(){
  const now = Date.now();
  if(!data.born){
    const passed = now - data.start;
    const remain = Math.max(0, WAIT_TIME - passed);
    bar.style.width = (remain / WAIT_TIME * 100) + "%";
    if(passed >= WAIT_TIME) hatch();
  }
  if(!data.dead && now - data.start >= LIFE_SPAN){
    data.dead=true;
    endGame();
  }
  save();
}
setInterval(tick,1000);

function care(type,choice){
  if(!data.born || data.dead) return;
  data.mood += Math.random()>0.5?1:-1;
  log(type,choice);
  save();
}

function clean(){
  if(!data.born || data.dead) return;
  data.mood += 0.5;
  log("clean","done");
  save();
}

function endGame(){
  actions.classList.add("hidden");
  document.getElementById("ending").classList.remove("hidden");
  setTimeout(()=>{
    document.getElementById("logView").classList.remove("hidden");
    document.getElementById("logView").textContent =
      JSON.stringify(data.logs,null,2);
  },3000);
}

function save(){
  localStorage.setItem(KEY,JSON.stringify(data));
}
</script>
</body>
</html>
