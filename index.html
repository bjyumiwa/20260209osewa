<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>3日間のお世話ゲーム</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body {
    margin: 0;
    font-family: system-ui, -apple-system, "Yu Gothic", "Meiryo", sans-serif;
    background: #f4f5f8;
    color: #222;
    text-align: center;
  }
  .container {
    max-width: 420px;
    margin: 0 auto;
    padding: 24px;
  }
  #character {
    width: 220px;
    height: 220px;
    margin: 80px auto 40px;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    transition: transform 2s ease, opacity 2s ease;
  }
  .float {
    animation: float 3s infinite ease-in-out;
  }
  @keyframes float {
    0% { transform: translateY(0); }
    50% { transform: translateY(-14px); }
    100% { transform: translateY(0); }
  }
  .actions {
    margin-top: 24px;
  }
  .actions button {
    margin: 6px;
    padding: 10px 14px;
    font-size: 14px;
  }
  .hidden {
    display: none;
  }
  #message {
    font-size: 14px;
    color: #666;
    margin-top: 12px;
  }
</style>
</head>
<body>
<div class="container">

  <div id="character"></div>
  <div id="message"></div>

  <div class="actions hidden" id="actions">
    <button onclick="care('meal','light')">軽い食事</button>
    <button onclick="care('meal','heavy')">しっかりした食事</button>
    <button onclick="care('out','go')">外に出る</button>
    <button onclick="care('out','stay')">家で過ごす</button>
    <button onclick="care('mini','A')">ミニゲームA</button>
    <button onclick="care('mini','B')">ミニゲームB</button>
    <button onclick="clean()">排泄を片付ける</button>
    <button onclick="toggleSitter()">シッター</button>
    <button onclick="useDrink()">ドリンク</button>
    <button onclick="useMacaron()">マカロン</button>
  </div>

</div>

<script>
/*
  ========= 設定 =========
*/
const EGG_TIME = 3 * 60 * 1000; // 3分
const STORAGE_KEY = "care_game_core";

/*
  ========= 初期化 =========
*/
let data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
  startTime: Date.now(),
  born: false,
  state: "egg",
  hearts: 5,
  mood: 0,
  poop: 0,
  logs: []
};

const characterEl = document.getElementById("character");
const messageEl = document.getElementById("message");
const actionsEl = document.getElementById("actions");

/*
  ========= 表示 =========
*/
function showEgg() {
  characterEl.style.backgroundImage = "url(public/char/egg.png)";
  messageEl.textContent = "……";
}

function hatch() {
  data.born = true;
  data.state = "alive";
  characterEl.classList.add("float");
  characterEl.style.backgroundImage = "url(public/char/born.png)";
  messageEl.textContent = "";
  actionsEl.classList.remove("hidden");
  log("birth", "hatched");
  save();
}

function updateCharacter() {
  if (!data.born) {
    showEgg();
  } else {
    if (data.mood >= 1) {
      characterEl.style.backgroundImage = "url(public/char/happy.png)";
    } else if (data.mood <= -1) {
      characterEl.style.backgroundImage = "url(public/char/sad.png)";
    } else {
      characterEl.style.backgroundImage = "url(public/char/normal.png)";
    }
  }
}

/*
  ========= 時間管理 =========
*/
function tick() {
  if (!data.born) {
    if (Date.now() - data.startTime >= EGG_TIME) {
      hatch();
    }
  } else {
    data.poop += 0.01;
    if (data.poop > 4) data.mood -= 0.01;
  }
  save();
  updateCharacter();
}

setInterval(tick, 1000);

/*
  ========= お世話 =========
*/
function care(type, choice) {
  if (!data.born) return;
  data.hearts += Math.random() > 0.5 ? 1 : -1;
  data.mood += Math.random() > 0.5 ? 1 : -1;
  log(type, choice);
  save();
  updateCharacter();
}

function clean() {
  if (!data.born) return;
  data.poop = Math.max(0, data.poop - 3);
  data.mood += 0.5;
  log("clean", "done");
  save();
}

function toggleSitter() {
  log("sitter", "toggle");
}

function useDrink() {
  if (!data.born) return;
  data.mood += 1;
  log("drink", "use");
}

function useMacaron() {
  log("macaron", "use");
}

/*
  ========= ログ =========
*/
function log(type, value) {
  data.logs.push({
    time: new Date().toLocaleString(),
    type,
    value
  });
}

function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

/*
  ========= 初期表示 =========
*/
updateCharacter();
</script>
</body>
</html>
